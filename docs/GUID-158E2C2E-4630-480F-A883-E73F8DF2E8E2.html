<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

<meta http-equiv="X-UA-Compatible" content="IE=EmulateIE11" /><meta name="copyright" content="(C) Copyright 2022" />
<meta name="DC.rights.owner" content="(C) Copyright 2022" />
<meta name="DC.type" content="topic" />
<meta name="DC.title" content="universal_audio_decoders" />
<meta name="DC.relation" scheme="URI" content="GUID-408D6777-0172-406B-8442-B97FD5287AC8.html" />
<meta name="DC.format" content="XHTML" />
<meta name="DC.identifier" content="universal-audio-decoders" />
<link rel="stylesheet" type="text/css" href="stylesheets/commonltr.css" />
<link rel="stylesheet" type="text/css" href="stylesheets/atmel.css" />
<link rel="stylesheet" type="text/css" href="./stylesheets/common-extended.css" /><title>universal_audio_decoders</title>
<meta name="Microsoft.Help.Id" content="GUID-32F3914E-5B2E-4D3C-898B-3A4760B287C7-universal-audio-decoders" />
<meta name="Microsoft.Help.TocParent" content="GUID-32F3914E-5B2E-4D3C-898B-3A4760B287C7" />
<meta name="Microsoft.Help.TocOrder" content="0" />
<meta name="Microsoft.Help.Locale" content="en-US" />
<meta name="Microsoft.Help.TopicLocale" content="en-US" />
<meta name="Microsoft.Help.DisplayVersion" content="MPLABÂ® Harmony Audio Apps Help Reference A 04/2022" />
<script language="javascript">
       
       if (window.parent.location.protocol != 'file:') {
				document.addEventListener('click', function(e) {
				    if (e.target) {
               if (e.target.nodeName == "A" ) {
                    if (!e.target.target) {
                      e.preventDefault();
                      e.stopPropagation();
                              
                      var origUrl = window.parent.location.href.substr(0, window.parent.location.href.indexOf("?"));
                      if (origUrl.length === 0) {
                          origUrl = window.parent.location.href;
                      }
                      var href= e.target.getAttribute("href");
                      var parts = href.split("#");
          
                      var url = "";
                      if (parts.length == 2 ) {
                        if (!parts[0].length) {
                            url = window.parent.location.search.replace('?','')
                        } else {
                            url = parts[0].replace('.html','');
                        }
                      } else {
                        url = parts[0].replace('.html','');
                      }

                      if (parts.length == 2) {
                          url += "#" + parts[1];
                      }
    
                      window.parent.location.href = origUrl + "?" + url;

                      return false;
                    }
               }
            }
				});
			}

		</script><script language="javascript">
        function cpy(id, button) {
        
            var element = document.getElementById(id);
            var content = element.getAttribute("content");
            var textArea = document.createElement("textarea");
            
            // Place in the top-left corner of screen regardless of scroll position.
            textArea.style.position = 'fixed';
            textArea.style.top = 0;
            textArea.style.left = 0;
            
            // Ensure it has a small width and height. Setting to 1px / 1em
            // doesn't work as this gives a negative w/h on some browsers.
            textArea.style.width = '2em';
            textArea.style.height = '2em';
            
            // We don't need padding, reducing the size if it does flash render.
            textArea.style.padding = 0;
            
            // Clean up any borders.
            textArea.style.border = 'none';
            textArea.style.outline = 'none';
            textArea.style.boxShadow = 'none';
            
            // Avoid flash of the white box if rendered for any reason.
            textArea.style.background = 'transparent';
            
            
            textArea.value = content;
            
            document.body.appendChild(textArea);
            textArea.focus();
            textArea.select();
            
            try {
               var successful = document.execCommand('copy');
               var msg = successful ? 'successful' : 'unsuccessful';
               if (!button.classList.contains("copied")){
                  button.textContent = "Copied";
                  button.classList.add("copied");
                  setTimeout(function(){
                    button.textContent = "Copy";
                    button.classList.remove("copied");
                  },1000);
               }
            } catch (err) {
              console.log('Oops, unable to copy');
            }
            
            document.body.removeChild(textArea);
        }
      </script><script language="javascript">
          
          // Add the MathML namespace to html
          var html = document.getElementsByTagName("html")[0],
          head = document.getElementsByTagName("head")[0];
          
          var mathJax = document.createElement("script");
          mathJax.src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-MML-AM_CHTML";
          head.appendChild(mathJax);
          
          html.setAttribute("xmlns:m","http://www.w3.org/1998/Math/MathML");
          
          function inIframe() { try { return window.self !== window.top; } catch (e) { return true; } }
          
          if (!inIframe()) { 
          
          var Default = "index.html?GUID-158E2C2E-4630-480F-A883-E73F8DF2E8E2"; 
          
          var displaylocation = "value" + window.location.href;
          
          var GUIDS = displaylocation.split('GUID');          
          
          if (displaylocation.indexOf('#GUID') != -1) {            
          var First = GUIDS[1].split('.html');  
          if (GUIDS[3]){First = GUIDS[2].split('.html');}
          if (GUIDS[4]){First = GUIDS[3].split('.html');}
          if (GUIDS[5]){First = GUIDS[4].split('.html');}
          
          var Second = GUIDS[2].split('#');   
          if (GUIDS[3]){Second = GUIDS[3].split('#');}
          if (GUIDS[4]){Second = GUIDS[4].split('#');}
          if (GUIDS[5]){Second = GUIDS[5].split('#');}
          
          Default = "index.html?" + "GUID" + First[0] + "GUID" + Second[0];     
          }                    
          window.top.location = Default;
          }       
          
        </script><style xml:space="">
        
          button.copy-code{
            display:none;
            padding:0.7em 1.4em;
            margin:0 0.3em 0.3em 0;
            border-radius:0.15em;
            box-sizing: border-box;
            text-decoration:none;
            font-family:'Roboto',sans-serif;
            text-transform:uppercase;
            font-weight:400;
            color:#FFFFFF;
            background-color:#9c9c9c;
            box-shadow:inset 0 -0.6em 0 -0.35em rgba(0,0,0,0.17);
            text-align:center;
            position:relative;
            border: 0;
            float: right;
            border-radius: .5em;
            cursor: pointer;
          }
          button.copy-code:active{
            top:0.1em;
          }
          
          pre:hover button.copy-code{
            display: inline-block !important;
          }
          button.copy-code.copied {
            cursor: default !important;
          }
          
          
          @media all and (max-width:30em){
            button.copy-code{
              display:block;
              margin:0.4em auto;
            }
          }
        
        
      </style></head>
<body id="universal-audio-decoders">
<h1 class="title topictitle1" id="ariaid-title1">universal_audio_decoders</h1><div class="body"><p class="p">This topic provides instructions and information about the MPLAB Harmony 3 Universal Audio decoders demonstration application, which is included in the MPLAB Harmony Library distribution.</p>
</div>
<div class="related-links">
<div class="familylinks">
<div class="parentlink"><strong>Parent topic:</strong> <a class="link" href="GUID-408D6777-0172-406B-8442-B97FD5287AC8.html">Harmony 3 audio application examples</a></div>
</div>
</div><div class="topic nested1" aria-labelledby="ariaid-title2" id="description"><h2 class="title topictitle2" id="ariaid-title2">Description</h2><div class="body"><p class="p">The Universal Audio Decoders application uses the MPLAB Harmony Decoder Library to decode music files on a USB thumb drive.</p>
<p class="p">The application configures the development board to be in USB Host mode, and supports the FAT32 file system. When a mass storage device is connected to the development board, the application begins to scan the root directory. Once the scan is complete, the first track in the list will be opened and played. The fill buffer routine will read a chunk of data as an input to the decoder of the supported file format. The decoder will decode the packet and send the first frame of audio data to the codec driver through I2S Driver and the output will be audible through the speakers. The following block diagram depicts a representation of the application.</p>
<p class="p">Button or touch controls provide typical VCR-like control over the playback, such as play/pause, rewind, and next track.</p>
<p class="p">The application currently supports ADPCM, WAV, MP3 and FLAC files.</p>

<div class="tablenoborder"><table cellpadding="4" cellspacing="0" summary="" class="table" frame="border" border="1" rules="all"><col style="width:" /><col style="width:" /><col style="width:" /><col style="width:" /><thead class="thead" style="text-align:left;"><tr class="row"><th class="entry cellrowborder" style="vertical-align:middle;" id="d6488e39"><span><strong class="ph b">Audio Format</strong></span></th>
<th class="entry cellrowborder" style="vertical-align:middle;" id="d6488e42"><span><strong class="ph b">Decoder Location</strong></span></th>
<th class="entry cellrowborder" style="vertical-align:middle;" id="d6488e45"><span><strong class="ph b">Sampling Rates (kHz)</strong></span></th>
<th class="entry cellrowborder" style="vertical-align:middle;" id="d6488e48"><span><strong class="ph b">Description</strong></span></th>
</tr>
</thead>
<tbody class="tbody"><tr class="row"><td class="entry cellrowborder" style="vertical-align:middle;" headers="d6488e39 "><span>ADPCM</span></td>
<td class="entry cellrowborder" style="vertical-align:middle;" headers="d6488e42 "><span>audio/decoder</span></td>
<td class="entry cellrowborder" style="vertical-align:middle;" headers="d6488e45 "><span>8, 16</span></td>
<td class="entry cellrowborder" style="vertical-align:middle;" headers="d6488e48 "><span>Adaptive Delta Pulse Code Modulation (ADPCM) is a sub-class of the Microsoft waveform (.wav) file format. In this demonstration, it only decodes ADPCM audio which has a WAV header. The extension name for this format is pcm.</span></td>
</tr>
<tr class="row"><td class="entry cellrowborder" style="vertical-align:middle;" headers="d6488e39 "><span>WAVE</span></td>
<td class="entry cellrowborder" style="vertical-align:middle;" headers="d6488e42 "><span>audio/decoder</span></td>
<td class="entry cellrowborder" style="vertical-align:middle;" headers="d6488e45 "><span>8 through 96</span></td>
<td class="entry cellrowborder" style="vertical-align:middle;" headers="d6488e48 "><span>The WAVE file format is the native file format used by Microsoft Windows for storing digital audio data.</span></td>
</tr>
<tr class="row"><td class="entry cellrowborder" style="vertical-align:middle;" headers="d6488e39 "><span>MP3</span></td>
<td class="entry cellrowborder" style="vertical-align:middle;" headers="d6488e42 "><span>helix_mp3</span></td>
<td class="entry cellrowborder" style="vertical-align:middle;" headers="d6488e45 "><span>8 through 48</span></td>
<td class="entry cellrowborder" style="vertical-align:middle;" headers="d6488e48 "><span>The MPEG 2.5 Layer 3 is a lossy digital compression formats for audio data. The current version of the MP3 Library is an open-source based on the Helix MP3 decoder used in RealPlayer. The version in MPLAB Harmony is v1.0.</span></td>
</tr>
<tr class="row"><td class="entry cellrowborder" style="vertical-align:middle;" headers="d6488e39 "><span>FLAC</span></td>
<td class="entry cellrowborder" style="vertical-align:middle;" headers="d6488e42 "><span>xiph_flac</span></td>
<td class="entry cellrowborder" style="vertical-align:middle;" headers="d6488e45 "><span>8 through 48</span></td>
<td class="entry cellrowborder" style="vertical-align:middle;" headers="d6488e48 "><span>FLAC stands for Free Lossless Audio Codec, here lossless, means that audio is compressed in FLAC without any loss in quality. The current version of the FLAC Library is an open-source version based on the Xiph FLAC decoder. The version in MPLAB Harmony is based on version 1.3.3 of the open source XIPH FLAC source.</span></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="topic nested1" aria-labelledby="ariaid-title3" id="architecture"><h2 class="title topictitle2" id="ariaid-title3">Architecture</h2><div class="body"><p class="p">There are two different projects packaged in this application.</p>
<p class="p">PIC32 MZ EF Curiosity 2.0 Project:</p>
<p class="p">One project runs on the PIC32 MZ EF Curiosity 2.0 board, using the PIC32MZ2048EFM144 microcontroller with 2 MB of Flash memory and 512 KB of RAM running at 198 MHz. Around 16K of heap is reserved for FLAC enabled projects. The PIC32 MZ EF Curiosity 2.0 board includes the following features:</p>
<ul class="ul"><li class="li"><p class="p">Four push buttons (SW1-SW4, only SW1 is used)</p>
</li>
<li class="li"><p class="p">Four LEDs (LED1-LED4, only LED1 is used)</p>
</li>
<li class="li"><p class="p">AK4954 Codec Daughter Board mounted on X32 HEADER 2 socket</p>
</li>
</ul>
<p class="p">The PIC32 MZ EF Curiosity 2.0 board does not include the AK4954 Audio Codec daughterboard, which is sold separately on microchipDIRECT as part number AC324954.</p>
<p class="p">The following figure illustrates the application architecture for the PIC32 MZ EF Curiosity 2.0 project without a display. The program takes up to approximately 14% (287 KB) of the PIC32MZ2048EFM144 microcontroller's program space, and 52% (273 KB) of the RAM. Around 16 KB of heap is reserved for FLAC based projects.</p>
<br /><img class="image" src="GUID-3E3FDB9D-0E53-4C37-8FF0-6D0A0FFC9FBD-low.png" /><br /><p class="p">The I2S (Inter-IC Sound Controller) is used with the AK4954 codec. The AK4954 is configured in slave mode, meaning it receives I<sup class="ph sup">2</sup>S clocks (LRCLK and BCLK) from the PIC32, and the I2S peripheral is configured as a master.</p>
<p class="p">SAM E70 Xplained Ultra Projects:</p>
<p class="p">One project runs on the SAM E70 Xplained Ultra Board, which contains a ATSAME70Q21B microcontroller with 2 MB of Flash memory and 384 KB of RAM running at 300 MHz using the following features:</p>
<ul class="ul"><li class="li"><p class="p">One push button (SW1, may be labeled as SW0 on some boards)</p>
</li>
<li class="li"><p class="p">Two LEDs (LED1 and 2, only LED1 is used)</p>
</li>
<li class="li"><p class="p">AK4954 Codec Daughter Board mounted on a X32 socket</p>
</li>
</ul>
<p class="p">The SAM E70 Xplained Ultra board does not include the AK4954 Audio Codec daughterboard, which is sold separately on microchipDIRECT as part numbers AC324954.</p>
<p class="p">The following figure illustrates the application architecture for the SAM E70 Xplained Ultra project. The program takes up to approximately 5% (110 KB) of the ATSAME70Q21B microcontroller's program space, and 19% (71 KB) of the RAM. Around 16 KB of heap is reserved for FLAC based projects.</p>
<br /><img class="image" src="GUID-84B43EE5-A78F-46A4-99F6-E4D598C5B079-low.png" /><br /><p class="p">The SSC (Synchronous Serial Controller) is used with the WM8904 codec, selected by a strapping option on the WM8904 daughterboard. The WM8904 is configured in master mode, meaning it generates the I<sup class="ph sup">2</sup>S clocks (LRCLK and BCLK), and the SSC peripheral is configured as a slave.</p>
</div>
</div>
<div class="topic nested1" aria-labelledby="ariaid-title4" id="demonstration-features"><h2 class="title topictitle2" id="ariaid-title4">Demonstration Features</h2><div class="body"><ul class="ul"><li class="li"><p class="p">USB MSD Host Client Driver (see USB MSD Host Client Driver Library)</p>
</li>
<li class="li"><p class="p">FAT File System (see File System Service Library)</p>
</li>
<li class="li"><p class="p">Audio real-time buffer handling</p>
</li>
<li class="li"><p class="p">AK4954 or WM8904 Codec Driver (see Audio Codec Driver Libraries)</p>
</li>
<li class="li"><p class="p">I<sup class="ph sup">2</sup>S usage in audio system (see I2S Driver Library)</p>
</li>
<li class="li"><p class="p">DMA (see DMA Peripheral Library)</p>
</li>
<li class="li"><p class="p">Timer (see Timer Peripheral Library)</p>
</li>
<li class="li"><p class="p">GPIO Control (see Port Peripheral Library)</p>
</li>
</ul>
</div>
</div>
<div class="topic nested1" aria-labelledby="ariaid-title5" id="tools-setup-differences"><h2 class="title topictitle2" id="ariaid-title5">Tools Setup Differences</h2><div class="body"><p class="p">For the project using the PIC32MZ, the I2S interface and the AK4954 as a Slave (the I2S peripheral generates the I<sup class="ph sup">2</sup>S clocks):</p>
<p class="p">When building a new application, start by creating a 32-bit MPLAB Harmony 3 project in MPLAB X IDE by selecting <em class="ph i">File &gt; New Project</em>. Chose the Configuration name based on the BSP. Select the appropriate processor (PIC32MZ2048EFM144 for the PIC32 MZ EF Curiosity 2.0). Click Finish.</p>
<p class="p">In the MHC, under Available Components select the BSP PIC32 MZ EF Curiosity 2.0. Under <em class="ph i">Audio&gt;Templates</em>, double-click on</p>
<p class="p">AK4954 Codec. Answer Yes to all questions except for the one regarding FreeRTOS; answer No to that one. Then under <em class="ph i">Libraries&gt;USB&gt;Host Stack</em>, double-click on MSD Client Driver. Finally, under <em class="ph i">Harmony&gt;System Services</em>, double-click on FILE</p>
<p class="p">SYSTEM.</p>
<p class="p">You should end up with a project graph that looks like this, after rearranging the boxes:</p>
<br /><img class="image" src="GUID-1E9FDBDF-D0B1-4E85-B0FF-E86D6C2C077A-low.png" /><br /><p class="p">Connect the MSD Client Driver block to the FILE SYSTEM block. Click on the FILE SYSTEM block.</p>
<p class="p">Under File System Settings, check the checkbox for Use File System Auto Mount Feature. Under Media0&gt;Media Configuration0, change the Media Type to SYS_FS_MEDIA_TYPE_MSD.</p>
<br /><img class="image" src="GUID-08B85AB0-1618-46BB-B576-D730A091C729-low.png" /><br /><p class="p">Click on the I2S Peripheral. In the Configurations Options, under 32/16-Bit Communication Select bits, select (AUDEN=1) 16-bit data, 16-bit FIFO, 32-bit Channel/64-bit Frame. Change Master Clock the Baud Rate to 44,100. Set the Frame Select Pin to C2. The configuration should look like this:</p>
<br /><img class="image" src="GUID-4BE466FD-5A35-4FC0-A4CA-77C8528E8B27-low.png" /><br /><p class="p">Under Tools, click on Clock Configuration. In the Clock Diagram:</p>
<ul class="ul"><li class="li"><p class="p">Change the Primary Oscillator frequency to 12,000,000 Hz, and select EC under POSCMOD.</p>
</li>
<li class="li"><p class="p">Change FPLLICLK to POSC, FPLLIDIV to DIV_2, and FPLLMULT to MUL_66 for an SPLL value of 198 MHz. Change the UPLLFSEL to FREQ_12MHZ.</p>
</li>
<li class="li"><p class="p">In the Reference Clock #1 section, check the ON and OE checkboxes,, and set ROTRIM1 to 393 and RODIV1 to 8. This should give a REFCLKO1 output of 11,291,601 Hz, which is 256 times the 44,100 Hz sample rate.</p>
</li>
</ul>
<br /><img class="image" src="GUID-DCB8AD52-5212-40F9-848C-FC3F25CB3E22-low.png" /><br /><br /><img class="image" src="GUID-C30D1468-FF2B-443B-BECC-FDD8AC2209A9-low.png" /><br /><p class="p">For the project using the E70, the SSC interface and the WM8904 as a Master (the WM8904 codec generates the I<sup class="ph sup">2</sup>S clocks), with or without a display:</p>
<p class="p">When building a new application, start by creating a 32-bit MPLAB Harmony 3 project in MPLAB X IDE by selecting <em class="ph i">File &gt; New Project</em>. Chose the Configuration name based on the BSP used. Select the appropriate processor (ATSAME70Q21B). Click Finish.</p>
<p class="p">In the MHC, under Available Components select the appropriate BSP (SAM E70 Xplained Ultra). Under <em class="ph i">Audio&gt;Templates</em>, double-click on WM8904 Codec. Answer Yes to all questions except for the one regarding FreeRTOS; answer No to that one. Then under <em class="ph i">Libraries&gt;USB&gt;Host Stack</em>, double-click on MSD Client Driver. Finally, under <em class="ph i">Harmony&gt;System Services</em>, double-click on FILE SYSTEM.</p>
<p class="p">You should end up with a project graph that looks like this, after rearranging the boxes:</p>
<br /><img class="image" src="GUID-DDB1676D-0451-4B20-97C6-F4ABE565BE68-low.png" /><br /><p class="p">Connect the MSD Client Driver block to the FILE SYSTEM block. Click on the FILE SYSTEM block.</p>
<p class="p">Under File System Settings, check the checkbox for Use File System Auto Mount Feature. Under Media0&gt;Media Configuration0, change the Media Type to SYS_FS_MEDIA_TYPE_MSD.</p>
<br /><img class="image" src="GUID-08B85AB0-1618-46BB-B576-D730A091C729-low.png" /><br /><p class="p">Click on the WM8904 Driver. In the Configurations Options, set the Sample Rate to 44,100.</p>
<p class="p">In the Clock Diagram, set MOSCEL to Main Crystal, check the Bypass checkbox, and uncheck the RC Crystal Oscillator and Main Crystal Oscillator boxes, to make use of the 12 MHz external oscillator:</p>
<br /><img class="image" src="GUID-5A9A2FB4-D893-46DB-BAF9-D4CF93F8BBBA-low.png" /><br /><p class="p">Also in the Clock Diagram, in the PCK2 tab of the <strong class="ph b">Programmable Clock Controller</strong> section, check the On checkbox, and set CSS to MAINCLK (12 MHz). Then check the SSC checkbox in the <strong class="ph b">Peripheral Clock Controller</strong> section.</p>
</div>
<div class="topic nested2" aria-labelledby="ariaid-title6" id="building-the-application"><h3 class="title topictitle3" id="ariaid-title6">Building the Application</h3><div class="body"><p class="p">This section identifies the MPLAB X IDE project name and location and lists and describes the available configurations for the demonstration</p>
<p class="p"><strong class="ph b">Description</strong></p>
<p class="p">The parent folder for these files is audio/apps/universal_audio_decoders. To build this project, you must open the audio/apps/universal_audio_decoders/firmware/*.X project file in MPLAB X IDE that corresponds to your hardware configuration.</p>
</div>
<div class="topic nested3" aria-labelledby="ariaid-title7" id="mplab-x-ide-project-configurations"><h4 class="title topictitle4" id="ariaid-title7">MPLAB X IDE Project Configurations</h4><div class="body"><p class="p">The following table lists and describes supported project configurations.</p>

<div class="tablenoborder"><table cellpadding="4" cellspacing="0" summary="" class="table" frame="border" border="1" rules="all"><col style="width:" /><col style="width:" /><col style="width:" /><thead class="thead" style="text-align:left;"><tr class="row"><th class="entry cellrowborder" style="vertical-align:middle;" id="d6488e297"><span><strong class="ph b">Project Name</strong></span></th>
<th class="entry cellrowborder" style="vertical-align:middle;" id="d6488e300"><span><strong class="ph b">BSP Used</strong></span></th>
<th class="entry cellrowborder" style="vertical-align:middle;" id="d6488e303"><span><strong class="ph b">Description</strong></span></th>
</tr>
</thead>
<tbody class="tbody"><tr class="row"><td class="entry cellrowborder" style="vertical-align:middle;" headers="d6488e297 "><span>uad_pic32mz_ef_c2_ ak4954</span></td>
<td class="entry cellrowborder" style="vertical-align:middle;" headers="d6488e300 "><span>pic32mz_ef_curiosity_v2</span></td>
<td class="entry cellrowborder" style="vertical-align:middle;" headers="d6488e303 "><span>This demonstration runs on the PIC32MZ2048EFM144 processor on the PIC32 MZ EF Curiosity 2.0 board and the AK4954 Audio Codec Daughter Board. The AK4954 codec is configured as the slave, and the I2S peripheral as the master. The project configuration is for reading data from a file on a USB Mass Storage Device. The data is sent to the headphone output of the codec daughter card via I2S protocol using the I2S PLIB.</span></td>
</tr>
<tr class="row"><td class="entry cellrowborder" style="vertical-align:middle;" headers="d6488e297 "><span>uad_sam_e70_xult_ wm8904_ssc</span></td>
<td class="entry cellrowborder" style="vertical-align:middle;" headers="d6488e300 "><span>sam_e70_xult</span></td>
<td class="entry cellrowborder" style="vertical-align:middle;" headers="d6488e303 "><span>This demonstration runs on the ATSAME70Q21B processor on the SAM E70 Xplained Ultra board and the WM8904 Audio Codec Daughter Board. The WM8904 codec is configured as the master, and the SSC peripheral as the slave. The project configuration is for reading data from a file on a USB Mass Storage Device. The data is sent to the headphone output of the codec daughter card via I2S protocol using the SSC PLIB.</span></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div class="topic nested2" aria-labelledby="ariaid-title8" id="configuring-the-hardware"><h3 class="title topictitle3" id="ariaid-title8">Configuring the Hardware</h3><div class="body"><p class="p">This section describes how to configure the supported hardware.</p>
<p class="p"><strong class="ph b">Description</strong></p>
<p class="p">For all configurations, a pair of headphones should be connected to the HP Out jack of the audio codec. A FAT32 file system USB Flash drive will be needed to inserted into the USB TARGET connector of the board. You will probably need a USB-A Female to Micro-B Male adapter cable to do so.</p>
<p class="p">Using the PIC32 MZ EF Curiosity 2.0 board and the AK4954 Audio Codec Daughter Board and I2S PLIB. The AK4954 daughter board is plugged into the set of X32 connectors on the right side of the board (X32 HEADER 2).</p>
<p class="p"><img class="image" src="GUID-1406173B-2A57-448E-A15E-6DF919205BD4-low.png" /><br /> <strong class="ph b">Note:</strong> The PIC32 MZ EF Curiosity 2.0 does not include the AK4954 Audio Codec daughterboard, which is sold separately on microchipDIRECT as part number AC324954.</p>
<p class="p">Using the SAM E70 Xplained Ultra board and the WM8904 Audio Codec Daughter Board and SSC PLIB. All jumpers on the WM8904 should be toward the <strong class="ph b">front:</strong></p>
<br /><img class="image" src="GUID-FD221BBA-DC3F-4E3D-9C36-5115AAFB96F8-low.png" /><br /><p class="p"><img class="image" src="GUID-1406173B-2A57-448E-A15E-6DF919205BD4-low.png" /><br /> <strong class="ph b">Note:</strong> The SAM E70 Xplained Ultra board does not include the WM8904 Audio Codec daughterboard, which is sold separately on microchipDIRECT as part number AC328904.</p>
</div>
</div>
<div class="topic nested2" aria-labelledby="ariaid-title9" id="running-the-demonstration"><h3 class="title topictitle3" id="ariaid-title9">Running the Demonstration</h3><div class="body"><p class="p">This section demonstrates how to run the demonstration.</p>
<p class="p"><strong class="ph b">Description</strong></p>
<p class="p"><img class="image" src="GUID-57DB06A2-EA58-4B31-9EB7-89B422BFC6ED-low.png" /><br />  <strong class="ph b">Important!</strong> Prior to using this demonstration, it is recommended to review the MPLAB Harmony 3 Release Notes for any known issues.</p>
<p class="p">Compile and program the target device. While compiling, select the appropriate MPLAB X IDE project based. Refer to Building the Application for details.</p>
<ol class="ol"><li class="li"><span class="indent-level-default">1.</span><p class="p">Connect headphones to the HP OUT jack of the Audio Codec Daughter Board.</p>
</li>
<li class="li"><span class="indent-level-default">2.</span><p class="p">Connect power to the board if necessary. The system will be in a wait state for USB to be connected (amber LED1 blinking).</p>
</li>
<li class="li"><span class="indent-level-default">3.</span><p class="p">Connect a USB mass storage device (thumb drive) that contains songs of supported audio format to the USB TARGET connector of the board. You will probably need a USB-A Female to Micro-B Male adapter cable to do so.</p>
</li>
<li class="li"><span class="indent-level-default">4.</span><p class="p">When the device is connected the system will scan for audio files. Once the scanning is complete and at least one file is found (green LED2 on steady), listen to the audio output on headphones connected to the board. Use Switch SW1 as described under Control Description to change the volume or advance to the next track.</p>
</li>
</ol>
<p class="p"><strong class="ph b">Control Description:</strong></p>
<p class="p">Long presses of the push button cycle between volume control and the linear track change mode.</p>
<p class="p">When in volume control mode, short presses of the push button cycle between Low, Medium, High, and Mute volume outputs. While in the Mute mode, a pause of the playback will also take place.</p>
<p class="p">When in the linear track change mode, short presses of the push button will seek to the end of the currently playing track and start the next track that was found in sequence. After all tracks have been played, the first track will start again in the same sequential order.</p>
<p class="p">Button control is shown in the table below.</p>
</div>
<div class="topic nested3" aria-labelledby="ariaid-title10" id="button-operations"><h4 class="title topictitle4" id="ariaid-title10">Button Operations</h4><div class="body">
<div class="tablenoborder"><table cellpadding="4" cellspacing="0" summary="" class="table" frame="border" border="1" rules="all"><col style="width:" /><col style="width:" /><thead class="thead" style="text-align:left;"><tr class="row"><th class="entry cellrowborder" style="vertical-align:middle;" id="d6488e402"><span><strong class="ph b">Long Press (&gt; 1 sec)</strong></span></th>
<th class="entry cellrowborder" style="vertical-align:middle;" id="d6488e405"><span><strong class="ph b">Short Press (&lt; 1 sec)</strong></span></th>
</tr>
</thead>
<tbody class="tbody"><tr class="row"><td class="entry cellrowborder" style="vertical-align:middle;" headers="d6488e402 "><span>Volume Control</span></td>
<td class="entry cellrowborder" style="vertical-align:middle;" headers="d6488e405 "><span>Low (-66 dB)</span></td>
</tr>
<tr class="row"><td class="entry cellrowborder" style="vertical-align:middle;" headers="d6488e402 "><span>-</span></td>
<td class="entry cellrowborder" style="vertical-align:middle;" headers="d6488e405 "><span>Medium (-48 dB)</span></td>
</tr>
<tr class="row"><td class="entry cellrowborder" style="vertical-align:middle;" headers="d6488e402 "><span>-</span></td>
<td class="entry cellrowborder" style="vertical-align:middle;" headers="d6488e405 "><span>High (0 dB)</span></td>
</tr>
<tr class="row"><td class="entry cellrowborder" style="vertical-align:middle;" headers="d6488e402 "><span>-</span></td>
<td class="entry cellrowborder" style="vertical-align:middle;" headers="d6488e405 "><span>Mute/Pause</span></td>
</tr>
<tr class="row"><td class="entry cellrowborder" style="vertical-align:middle;" headers="d6488e402 "><span>Linear Track Change</span></td>
<td class="entry cellrowborder" style="vertical-align:middle;" headers="d6488e405 "><span>Next sequential track</span></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="topic nested3" aria-labelledby="ariaid-title11" id="status-indicator-description"><h4 class="title topictitle4" id="ariaid-title11">Status Indicator Description</h4><div class="body"><p class="p">When the application first starts running, it looks to find an attached storage device. If one is not found, LED1 will toggle on and off about every 100ms indicating that a storage device is not attached.</p>
<p class="p">When a storage device is attached, LED1 will turn off. At this time, the file system will be scanned for supported files with the appropriate extension.</p>
<p class="p">If no supported files are found on the storage device, LED2 will remain off and scanning of the device will continue.</p>
<p class="p">If any supported files are found, LED2 will turn on and playback of the first file found in sequence will start.</p>
<p class="p">LED status indication is shown in the table below.</p>
</div>
</div>
<div class="topic nested3" aria-labelledby="ariaid-title12" id="led-status"><h4 class="title topictitle4" id="ariaid-title12">LED Status</h4><div class="body">
<div class="tablenoborder"><table cellpadding="4" cellspacing="0" summary="" class="table" frame="border" border="1" rules="all"><col style="width:" /><col style="width:" /><col style="width:" /><thead class="thead" style="text-align:left;"><tr class="row"><th class="entry cellrowborder" style="vertical-align:middle;" id="d6488e459"><span><strong class="ph b">Operation</strong></span></th>
<th class="entry cellrowborder" style="vertical-align:middle;" id="d6488e462"><span><strong class="ph b">LED1 Status (Red)</strong></span></th>
<th class="entry cellrowborder" style="vertical-align:middle;" id="d6488e465"><span><strong class="ph b">LED2 Status (Green)</strong></span></th>
</tr>
</thead>
<tbody class="tbody"><tr class="row"><td class="entry cellrowborder" style="vertical-align:middle;" headers="d6488e459 "><span>No Storage Device Connected</span></td>
<td class="entry cellrowborder" style="vertical-align:middle;" headers="d6488e462 "><span>Toggle 100ms</span></td>
<td class="entry cellrowborder" style="vertical-align:middle;" headers="d6488e465 "><span>Off</span></td>
</tr>
<tr class="row"><td class="entry cellrowborder" style="vertical-align:middle;" headers="d6488e459 "><span>Storage Device Connected</span></td>
<td class="entry cellrowborder" style="vertical-align:middle;" headers="d6488e462 "><span>Off</span></td>
<td class="entry cellrowborder" style="vertical-align:middle;" headers="d6488e465 "><span>See Files Found Operation</span></td>
</tr>
<tr class="row"><td class="entry cellrowborder" style="vertical-align:middle;" headers="d6488e459 "><span>Playback: Volume Control</span></td>
<td class="entry cellrowborder" style="vertical-align:middle;" headers="d6488e462 "><span>Off</span></td>
<td class="entry cellrowborder" style="vertical-align:middle;" headers="d6488e465 "><span>See Files Found Operation</span></td>
</tr>
<tr class="row"><td class="entry cellrowborder" style="vertical-align:middle;" headers="d6488e459 "><span>Playback: Volume Mute</span></td>
<td class="entry cellrowborder" style="vertical-align:middle;" headers="d6488e462 "><span>Toggle 500ms</span></td>
<td class="entry cellrowborder" style="vertical-align:middle;" headers="d6488e465 "><span>See Files Found Operation</span></td>
</tr>
<tr class="row"><td class="entry cellrowborder" style="vertical-align:middle;" headers="d6488e459 "><span>Playback: Linear Track Change</span></td>
<td class="entry cellrowborder" style="vertical-align:middle;" headers="d6488e462 "><span>On</span></td>
<td class="entry cellrowborder" style="vertical-align:middle;" headers="d6488e465 "><span>See Files Found Operation</span></td>
</tr>
<tr class="row"><td class="entry cellrowborder" style="vertical-align:middle;" headers="d6488e459 "><span>Files Found (Yes/No)</span></td>
<td class="entry cellrowborder" style="vertical-align:middle;" headers="d6488e462 "><span>See above operations</span></td>
<td class="entry cellrowborder" style="vertical-align:middle;" headers="d6488e465 "><span>On/Off</span></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
</div>
</body>
</html>